<p align="center">
  <img width="460" height="300" src="visualization/images/iot.png">
</p>

# Predicing Internet of Things(IoT Malware Attacks)

## Navigating Project Directory:

### Executive Summary
Overview of Business Understanding, Data Understanding, Data Preparation, Modeling and Results communicated here

[Project Presentation](reports/Predicting_IoT_Malware_Attacks.pdf)

### Data
Details on how to download datasets to run this project. <BR>
[Download Instruction](data/ReadME.md)<BR>
[Data Pickle Files - Each device has the class objects instantiated here in directory data_prep/](https://github.com/ghPRao/IoT_Malware_Attacks/blob/IoT-CS/data_prep/)
> Note: Pickle file can be read and used for modeling OR recreate as needed.

### Notebooks 
[Exploratory Data Analysis](notebooks/exploratory/EDA.ipynb)<BR>
[Constants Used Globally](src/data_constants.py)<BR>
[Model Preparation/Execution(main engine)](notebooks/final/Predict_IoT_Attacks.py)<BR>

### Reports
[Final Project Presentation](reports/Predicting _IoT_Malware_Attacks.pdf)<BR>
[Final Project Notebook](reports/Final_Notebook_model_prep.pdf)

### Visualization
[Visualization Charts](https://github.com/ghPRao/IoT_Malware_Attacks/blob/IoT-CS/visualization/) 
    
## Business Understanding

There is an exponential growth of Internet of Things (IoT) devices connected to the internet used by both cosumers and enterprises. By end of 2020, ~31 billion devices are connected and will double in the next  uears. The pervaisve nature of these devices and also with minimum security protection, spammers and scammerers have been launching botnets and malwares easily found in opensource. More than 2/3rd of enterprise networks had experienced cyber attacks on IoT devices. 

IoT networks have become an increasingly valuable target of malicious attacks due to the increased amount of valuable user data they contain.
Botnet-powered distributed denial of service (DDoS) attacks have used infected IoT devices to bring down websites. IoT devices can be used to direct other attacks. For instance, there may be future attempts to weaponize IoT devices. A possible example would be a nation shutting down home thermostats in an enemy state during a harsh winter. In response, network intrusion detection systems have been developed to detect suspicious network activity. Routers are trained to identify cyber threats.

To mitigate the challenges, beyond the router capabilities to detect DDoS and traffic anamolies, you also need the learning from the past attack. For this this study, I will explore how Machine Learning can accurately predict if a given traffic instanc is infected with malware attack

## Data Understanding
In 2016, there was a major botnet attack on IoT devices which crippled networks in several part of the world. One such malware is "Mirai". Prior experimental studies on the detection of IoT botnets or IoT traffic anomalies typically relied on emulated or simulated data. A better source of actual data collected during "Mirai" and 'Bashlite" botnet attacks on IoT devices are available at  <sup>1</sup>UCI Machine Learning Repository(https://archive.ics.uci.edu/ml/datasets/detection_of_IoT_botnet_attacks_N_BaIoT#)

This dataset enables empirical evaluation with **real** traffic data, gathered from nine commercial IoT devices infected by authentic botnets from two families in an isolated network. It facilitates the examination of Mirai and BASHLITE, two of the most common IoT-based botnets, which have already demonstrated their harmful capabilities.

### Data Contents
Approximately 7.5GB of datasets are organized for 9 different types of common IoT devices such as doorbells, security monitors, webcam, and baby monitors. For each of the botnet, a separate directory consist of traffic data collected on various ports.

The file structure and the content of the files are below:

```
├── N_BaIoT_dataset_description_v1.txt--------> Description about source of the data, information on features etc.
├── Ecobee_Thermostat-------------------------> IoT Device
│   ├── gafgyt_attacks------------------------> gafgyt attacks traffic types
│   │   ├── scan.csv-----> Scanning the network for vulnerable devices
│   │   ├── tcp.csv------> TCP flooding
│   │   ├── udp.csv------> UDP flooding
│   │   ├── junk.csv-----> Sending spam data
│   │   └── combo.csv---->Sending spam data and opening a connection to a specified IP address and port
│   ├── mirai_attacks----> Mirai attack traffic file
│   │   ├── syn.csv------> SYN flooding
│   │   ├── scan.csv-----> Scanning the network for vulnerable devices
│   │   ├── udpplain.csv-> UDPPLAIN flooding
│   │   ├── ack.csv------> ACK flooding
│   │   └── udp.csv------> UDP flooding
│   └── benign_traffic.csv--> Benign traffic observation for Ecobee Thermostat
├── SimpleHome_XCS7_1002_WHT_Security_Camera
│   ├── gafgyt_attacks
│   │   ├── scan.csv
│   │   ├── tcp.csv
│   │   ├── udp.csv
│   │   ├── junk.csv
│   │   └── combo.csv
│   ├── mirai_attacks
│   │   ├── syn.csv
│   │   ├── scan.csv
│   │   ├── udpplain.csv
│   │   ├── ack.csv
│   │   └── udp.csv
│   └── benign_traffic.csv--> Benign traffic observation for SimpleHome XCS7-1002WHT Security Camera
├── Damini_Doorbell
│   ├── gafgyt_attacks
│   │   ├── scan.csv
│   │   ├── tcp.csv
│   │   ├── udp.csv
│   │   ├── junk.csv
│   │   └── combo.csv
│   ├── mirai_attacks
│   │   ├── syn.csv
│   │   ├── scan.csv
│   │   ├── udpplain.csv
│   │   ├── ack.csv
│   │   └── udp.csv
│   └── benign_traffic.csv--> Benign traffic observation for Damini Doorbell
├── SimpleHome_XCS7_1003_WHT_Security_Camera
│   ├── gafgyt_attacks
│   │   ├── scan.csv
│   │   ├── tcp.csv
│   │   ├── udp.csv
│   │   ├── junk.csv
│   │   └── combo.csv
│   ├── mirai_attacks
│   │   ├── syn.csv
│   │   ├── scan.csv
│   │   ├── udpplain.csv
│   │   ├── ack.csv
│   │   └── udp.csv
│   └── benign_traffic.csv--> Benign traffic observation for SimpleHome XCS7-1003WHT Security Camera
├── Samsung_SNH_1011_N_Webcam
│   ├── gafgyt_attacks
│   │   ├── scan.csv
│   │   ├── tcp.csv
│   │   ├── udp.csv
│   │   ├── junk.csv
│   │   └── combo.csv
│   └── benign_traffic.csv--> Benign traffic observation for  Samsung SNH-1011N Webcam
├── Ennino_Doorbell
│   ├── gafgyt_attacks
│   │   ├── scan.csv
│   │   ├── tcp.csv
│   │   ├── udp.csv
│   │   ├── junk.csv
│   │   └── combo.csv
│   ├── mirai_attacks
│   │   ├── syn.csv
│   │   ├── scan.csv
│   │   ├── udpplain.csv
│   │   ├── ack.csv
│   │   └── udp.csv
│   └── benign_traffic.csv--> Benign traffic observation for Ennino_Doorbell
├── Philips_B120N10_Baby_Monitor
│   ├── gafgyt_attacks
│   │   ├── scan.csv
│   │   ├── tcp.csv
│   │   ├── udp.csv
│   │   ├── junk.csv
│   │   └── combo.csv
│   ├── mirai_attacks
│   │   ├── syn.csv
│   │   ├── scan.csv
│   │   ├── udpplain.csv
│   │   ├── ack.csv
│   │   └── udp.csv
│   └── benign_traffic.csv--> Benign traffic observation for Philips B120N10 Baby Monitor
├── demonstrate_structure.csv --------> For demostration, all feature names are in this file
├── Provision_PT_737E_Security_Camera
│   ├── gafgyt_attacks
│   │   ├── scan.csv
│   │   ├── tcp.csv
│   │   ├── udp.csv
│   │   ├── junk.csv
│   │   └── combo.csv
│   ├── mirai_attacks
│   │   ├── syn.csv
│   │   ├── scan.csv
│   │   ├── udpplain.csv
│   │   ├── ack.csv
│   │   └── udp.csv
│   └── benign_traffic.csv--> Benign traffic observation for Provision PT737E Security Camera
└── Provision_PT_838_Security_Camera
    ├── gafgyt_attacks
    │   ├── scan.csv
    │   ├── tcp.csv
    │   ├── udp.csv
    │   ├── junk.csv
    │   └── combo.csv
    ├── mirai_attacks
    │   ├── syn.csv
    │   ├── scan.csv
    │   ├── udpplain.csv
    │   ├── ack.csv
    │   └── udp.csv
    └── benign_traffic.csv--> Benign traffic observation for Provision PT838 Security Camera
```

### Attribute Information:
```
The following describes each of the features headers:

* Stream aggregation:
H: Stats summarizing the recent traffic from this packet's host (IP)
HH: Stats summarizing the recent traffic going from this packet's host (IP) to the packet's destination host.
HpHp: Stats summarizing the recent traffic going from this packet's host+port (IP) to the packet's destination host+port. Example 192.168.4.2:1242 -> 192.168.4.12:80
HH_jit: Stats summarizing the jitter of the traffic going from this packet's host (IP) to the packet's destination host.

* Time-frame (The decay factor Lambda used in the damped window):
How much recent history of the stream is capture in these statistics
L5, L3, L1, ...

* The statistics extracted from the packet stream:
weight: The weight of the stream (can be viewed as the number of items observed in recent history)
mean: ...
std: ...
radius: The root squared sum of the two streams' variances
magnitude: The root squared sum of the two streams' means
cov: an approximated covariance between two streams
pcc: an approximated covariance between two streams
    
```

## Data Preparation
First, I downloaded all data files to 'data' directory under this project. Due to large size of the dataset, it is recommended to download diretly from UCI ML Repository at http://archive.ics.uci.edu/ml/machine-learning-databases/00442/demonstrate_structure.csv and store it in a directory structure as in the previous section.


### Exploring observation data:
Combined observations from all traffic types and devices have 7574739 observations. For the Samsung Webcam, there was no Mirai attack data, so assume that Mirai didn't infect these cameras. Between the three type of traffics --benign, mirai, and bashlite-- you will notice a class imbalance. Although for cyber attack like these, typically you will expect a lot of threat records compared to normal traffic, however it depends on number of devices infected. 

<p align="center">
  <img width="800" height="800" src="visualization/images/data_explore.png">
</p>

### Feature Selection:
To prepare observation data for building models, I first explored the data in the notebook notebook/exploratory/EDA.ipynb: 
- There are 115 features in each of the dataset, however I noticed that columns were grouped together with a count of records in given timeframe(H_L5_weight) also had corresponding statistical representation of the same.

- After reviewing each column, I found 'H_L5_weight', 'H_L3_weight', 'H_L1_weight', 'H_L0.1_weight', 'H_L0.01_weight','HH_L5_weight','HH_L3_weight', 'HH_L1_weight', 'HH_L0.1_weight', 'HH_L0.01_weight', 'HH_jit_L5_weight','HH_jit_L3_weight','HH_jit_L1_weight','HH_jit_L0.1_weight', 'HH_jit_L0.01_weight', had also corresponding statistical represenation (HH_L5_mean, HH_L5_std, HH_L5_magnitude, HH_L5_radius, HH_L5_covarianc, HH_L5_pcc). To save memory to run on a single machine for the large datasets, I took a decision to drop these statistical observation columns.

- There was also class imbalance noted in all datasets. For the model training and testing, I chose allnormal traffic and equal number of  malware traffic to combine from 'Mirai' and 'Bashlite' data. Finally shuffled to avoid any patterns in selecting observations.

- There is no explicit target label identifying nature of traffic. Hence,  created one from file directory structure
     with values Benign(Normal), Mirai, and Bashlight.


- In addition to feature selection, I decided to create Python class for every device and store and results like key results for quick access later. The class was also **pickled** for each device stored under data-prep directory. If a pickle file is not already created for a device, it would run all models for a given device and finally pickle it.


## Model Selection and Development
For training and testing predicting malware attacks, I tested the data using Supervised Learning algorithms and because of multi-classification in the target data, I tested with classification models such as Logistic Regression, Decision Tree, KNN Classifier, Random Forest, and XGBoost models. 

To compare the performance of each model, I selected "Recall" and "Accuracy" as measures. Recall is the most important measure , because i wanted to minimize the number of False Negatives which would mean a malware infected traffic is incorrectly classified as normal. Accuracy reflects the over all performance of a model.

While training and testing the model, ** Confustion Matrix *** was created for every deice for testing and validation sets and stored as charts under 'visualization' directory.

Finally, the model is tested on the 30% holdout data as the final result.


## Model Evaluation
Although all the models had a good predictive scores, I chose between Random Forest, and XGBoost.  Random Forest was computationally expensive, so selcted XGBoost as the final model, because the use of gradient decent algorithm and ease of training. 

<div class="row">
  <div class="container">
    <img width="400" height="400" src="visualization/images/Damini_Doorbell_Final_Test Data_LogisticRegression.png" >
  </div>
  <div class="container">
    <img width="400" height="400" src="visualization/images/Damini_Doorbell_Final_Test_Data_KNeighborsClassifier.png" >
  </div>
  <div class="container">
    <img width="400" height="400" src="visualization/images/Damini_Doorbell_Final_Test Data_DecisionTreeClassifier.png" >
  </div>
  <div class="container">
    <img width="400" height="400" src="visualization/images/Damini_Doorbell_Final_Test_Data_RandomForestClassifer.png" >
  </div>
  <div class="container">
    <img width="400" height="400" src="visualization/images/Damini_Doorbell_Final Test Data_XGBClassifier.png" >
  </div>
</div>


## Business Deployment
The IoT Malware Attack predictive model provides a deterrant strategy from network traffic data to identify if there are know malware attacks (Mirai, Bashlite) in the traffic to maintain health of the network. However, the models needs to be trained to expose new type of malwares. For future considerations, this project may be expanded to identify any sudden spike in traffic in a given timeframe

## How to run the code:
There are two ways to run the models:<BR>
1) Interactively run notebOok <BR>
[Interactively Run Models](notebooks/final/Predict_IoT_Attacks.ipynb)
    
2) Run from command line
This will do data preparation of all 95 datasets, instantiate class object for each of the 9 devices and pickle them in data-prep directory Runs 5 Supervised Learning Models (Logistic Regression, KNN, Decision Tree, Random Forest, and XGBoost) and evaluate Recall and Accuracy for each of those 45 models ( 9 devices x 5 models)<BR>
[Run Python .py](notebooks/final/Predict_IoT_Attacks.py)  
    

### Future Development Opportunities:
This project may be further enhanced to inclde the following ideas:
- Which of the 10 attacks carried by 2 botnets are more vulnerable?
    - Expand number of classification to 11

- How well the model perform if exposed to entire `7.5GB data once.
    - Run models in the cloud (AWS) with the entire ~7.5GB of data 

- Expose the model to new data infected by different malware attacks.
    - Expand to include additional data sources from more latest malware attacks 

## Summary

Internet of Things is pervasive and connects to network ubiquitously anytime and anywhere. As these devices have very little resources to protect again malware attacks, networks should become more intelligent to identify future attacks. However, mallicious actors implant botnets resulting in terra-bytes of data flood the network and eventually bring it to down. Learning from the past attack is a deterrant strategy which paves a path to propose Machine Learning predictive models guide to identify such attachs. This project has identified Random Forest model can potentially identify almost all malicious traffic when encountered
 

## References:
<sup>1</sup> "detection_of_IoT_botnet_attacks_N_BaIoT " (https://archive.ics.uci.edu/ml/datasets/detection_of_IoT_botnet_attacks_N_BaIoT#)

